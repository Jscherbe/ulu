@use "sass:map";
@use "sass:meta";
@use "utils";

/// Base line height
/// @group Library:Typography
/// @type Number
/// @link https://developer.mozilla.org/en-US/docs/Web/CSS/line-height MDN 1.5 is best for low vision, Dyslexia

$line-height: 1.5 !default; 

/// Base dense line height
/// @group Library:Typography
/// @type Number

$line-height-dense: 1.2 !default;

/// Base font-size set in rem's
/// @group Library:Typography
/// @type Number

$font-size: 16px !default;

/// Base font-family
/// @group Library:Typography
/// @type Number

$font-family: ui-sans-serif, "Open Sans", Helvetica, Arial, sans-serif !default;

/// Base font-family for monospace
/// @group Library:Typography
/// @type String

$font-family-monospace: ui-monospace, SFMono-Regular, Consolas, Menlo, monospace !default;

/// Base font-size multiplier (used for presets if they are unaltered)
/// @group Library:Typography
/// @type Number

$size-multiplier: 0.15 !default; // Each size would be increased/decreased by 25% from the base

/// Responsive Typography Viewport Percentage (use vw units)
/// @group Library:Typography
/// @type Number

$responsive-change: 0.2vw !default; // Each size would be increased/decreased by 25% from the base

/// Default Margin (bottom only)
/// @group Library:Typography
/// @type Number

$margin: 0.75em !default;

/// Get scale of the base font-size
/// @group Library:Typography
/// @param {Number} $scale Scale to get
/// @return {Number} Base font-size scaled

@function font-size-scale($scale) {
  @return utils.calculate-scale-percentage(1rem, $size-multiplier, $scale);
}

/// Default size presets
/// @group Library:Typography
/// @type Map

$sizes: (
  "small-x" : (
    "font-size": font-size-scale(-2),
    "line-height": $line-height,
    "responsive" : true
  ),
  "small" : (
    "font-size": font-size-scale(-1),
    "line-height": $line-height,
    "responsive" : true
  ),
  "base" : (
    "font-size": font-size-scale(0),
    "line-height": $line-height,
    "responsive" : true
  ),
  "large" : (
    "font-size": font-size-scale(2),
    "line-height": $line-height,
    "responsive" : true
  ),
  "large-x" : (
    "font-size": font-size-scale(6),
    "line-height": $line-height,
    "responsive" : true
  ),
  "large-xx" : (
    "font-size": font-size-scale(8),
    "line-height": $line-height,
    "responsive" : true
  ),
  "large-xxx" : (
    "font-size": font-size-scale(10),
    "line-height": $line-height,
    "responsive" : true
  )
) !default;

/// Update the typography presets map
/// @group Library:Typography
/// @param {Map} $changes A map to merge into the color palette
/// @param {Map} $deep Use deep merge
/// @param {Map} $overwrite Overwrite the presets completly (cannot be used with deep)
/// @example scss Setting the error and type color
///   @include typography.set((
///     "small" : 0.8rem
///   ));

@mixin set-sizes($changes, $deep: false, $overwrite: false) {
  @if $deep {
    $presets: map.deep-merge($presets, $changes) !global;
  } @else if $overwrite {
    $presets: $changes !global;
  } @else {
    $presets: map.merge($presets, $changes) !global;
  }
}

/// Print a typography size (font-size, line-height)
/// @group Library:Typography
/// @param {String} $name Name to lookup 
/// @param {String} $line-height Print out size's line-height, or override it, pass false to not include

@mixin size($name, $line-height: true) {
  $size: utils.map-get-required($sizes, $name, 'typography');
  $fs: map.get($size, "font-size");
  $responsive: map.get($size, "responsive");

  font-size: $fs;

  @if ($responsive) {
    $r: if(meta.type-of($responsive) == number, $responsive, $responsive-change);
    font-size: calc(#{ $fs } + #{ $r });
  }

  @if $line-height {
    @if (meta.type-of($line-height) == number) {
      line-height: $line-height;
    } @else {
      line-height: map.get($size, "line-height");
    }
  }
}

/// Convert pixel value to rem value based on typography $font-size
/// @group Library:Typography
/// @param {Number} $pixels Pixel value to convert from
/// @return {Number} Rem value

@function to-rem($pixels) {
  @return ($pixels / $font-size) + rem;
}

/// Break word stradegy
/// @group Library:Typography
/// @param {Boolean} $force Force words to break (will have unusual breaks)

@mixin word-break($force: false) {
  word-break: if($force, break-all, normal);
  word-break: break-word;
  hyphens: auto;
}